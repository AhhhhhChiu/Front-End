浏览器渲染原理
---
**渲染步骤**

1. 拿到代码后，浏览器在内存中开辟出一块栈内存，用来给代码的执行提供环境，同时分配一个主线程去一行行解析和执行代码。
2. 遇到\<img>\<link>\<script>等标签，浏览器都会开辟新的线程去加载文件
3. 把加载任务放到任务队列里
4. 主线程解析执行完所有代码后生成DOM树
5. 到队列中找加载完成的执行，执行完又到队列里找，知道等待队列全部执行完。该过程是单线程的，也称事件循环。
6. CSS全部处理完生成CSSOM
7. DOM Tree + CSSOM Tree => Render Tree
8. 回流：根据Render Tree计算它们在视口中的大小和位置
9. 重绘：根据回流信息得到节点的绝对像素
10. 将像素发给GPU，展示在页面上

**回流和重绘**

1. 改变样式不改变大小和位置时(color、background-color...)只重绘不回流
2. 回流一定会重绘，重绘不一定回流

**性能优化**

1. 减少HTTP请求次数和大小
   1. 资源(CSS、js)合并压缩
   2. 图片懒加载
   3. 音视频走流文件
2. 减少回流和重绘
   1. 放弃操作DOM，使用vue/react
   2. 分离读写操作：当代浏览器有渲染队列机制
   3. 批量处理：通过someElem.style.cssText一次性修改样式/直接改someElem.className
   4. 缓存处理(本质分离读写)：读DOM属性拿变量存起来，后续再修改
   5. 批量添加子节点时避免直接添加
      1. 先创建一个文档碎片(临时容器)，往碎片添加，再把碎片添加到父节点中。
      2. 字符串拼接
   6. 动画效果应用到position为absolute或fixed的元素中(脱离文档流，也会回流但性能影响相对低)
   7. 使用transform、opacity、filters...会触发硬件加速不回流
   8. 牺牲平滑度换取性能
   9. 避免table布局和使用css的JavaScript表达式